/*!
 * yyl-ssr-fetcher cjs 0.1.1
 * (c) 2020 - 2020 jackness
 * Released under the MIT License.
 */
"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("request")),r=e(require("extend"));const s=/^\/\//;exports.Fetcher=class{constructor(e){this.timeout=5e3,this.userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.122 Safari/537.36 ServerSide",this.requestOption={},this.defaultProtocol="http:",(null==e?void 0:e.timeout)&&(this.timeout=e.timeout),(null==e?void 0:e.userAgent)&&(this.userAgent=e.userAgent),(null==e?void 0:e.requestOption)&&(this.requestOption=e.requestOption),this.requestOption=r({headers:{"User-Agent":this.userAgent},timeout:this.timeout},this.requestOption)}formatUrl(e){const{defaultProtocol:t}=this;let r=e;return r.match(s)&&(r=`${t}${r}`),r}get(e,s,o){const{requestOption:i}=this,u=this.formatUrl(e),n="请求"+u;let a=Object.assign({qs:s||{}},i);return i&&(a=r(a,o)),new Promise((e,r)=>{t.get(u,a,(t,s,o)=>{if(t)r(t);else if(200===s.statusCode)try{e(JSON.parse(o))}catch(e){r(new Error(`${n}失败: parse error: ${o}`))}else r(new Error(`${n}失败: 状态非 200: ${s.statusCode}`))})})}post(e,s,o){const{requestOption:i}=this,u=this.formatUrl(e),n="请求"+u;let a=Object.assign({formData:s||{}},i);return i&&(a=r(a,o)),new Promise((e,r)=>{t.post(u,a,(t,s,o)=>{if(t)r(t);else if(200===s.statusCode)try{e(JSON.parse(o))}catch(e){r(new Error(`${n}失败: parse error: ${o}`))}else r(new Error(`${n}失败: 状态非 200: ${s.statusCode}`))})})}};
